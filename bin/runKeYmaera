#!/bin/sh

echo "Using JDK installation from:      $JAVA_HOME"

JAVA_OPTIONS=

#
# Now $KEY_HOME  
#

if [ -z "$KEY_HOME" ] ; then
	export KEY_HOME=`pwd`
fi
echo "Using KeY installation from:      $KEY_HOME"


if [ -z "$KEY_LIB" ] ; then
   KEY_LIB="$KEY_HOME/key-ext-jars"
else
echo "Using libraries from:             $KEY_LIB"
fi


#
# KeY CLASSPATH
#

key_ext_jars="antlr.jar antlr3.jar stringtemplate.jar jargs.jar recoderKey.jar dresden-ocl-demo.jar xerces.jar log4j.jar JLink/JLink.jar orbital-ext.jar orbital-core.jar"

keyclasspath="$KEY_HOME/system/binary/"

for i in $key_ext_jars ; do
    current_jar="$KEY_LIB/$i"
    if [ ! -f $current_jar ]
    then
       echo Cannot find $current_jar. 
       echo Copy or link the file into the
       echo $KEY_LIB directory.
       exit 1
    else
       keyclasspath="${keyclasspath}:$current_jar"
    fi
done

#
# KeY-specific command line options
#

keysysprops=""
while [ $# -ne 0 ]; do
    case $1 in
        -keydebug) keysysprops="${keysysprops}-DKeyDebugFlag=on "
            shift
            continue;;

        -server) keysysprops="${keysysprops}-server "
            shift
            continue;;

        -debugclassloader) keysysprops="${keysysprops}-DKeyDebugClassLoader=on "
            shift
            continue;;

        -*)  keysysprops="${keysysprops}${1} "
            shift
            continue;;

        *)  keyarg="${keyarg}${1} "
            shift
            continue;;
    esac
done	

# Fallback for KeY-specific binaries
PATH=${PATH}:$KEY_LIB
export PATH


#
# This command actually runs KeY
#
#-server \
#-XX:CompileThreshold=1500 \

exec java $JAVA_OPTIONS $keysysprops $hpfix \
-ea:de.uka.ilkd.key... -noverify -Xms64m -Xmx1024m \
-Dkey.home=$KEY_HOME \
-Dsun.awt.exception.handler=de.uka.ilkd.key.gui.ExceptionalHandler \
-Djava.library.path=$KEY_HOME/system/binary:/usr/lib \
-classpath $keyclasspath de.uka.ilkd.key.gui.Main $keyarg dL
